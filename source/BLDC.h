/*
 * BLDC.h
 *
 *  Created on: 04.11.2020
 *      Author: Marcin
 */

#ifndef BLDC_H_
#define BLDC_H_

#include <mbed.h>
#include <array>

class MotorBLDC
{
public:
    MotorBLDC(PinName outA, PinName outB, PinName outC, PinName enable);
private:
    float fastSineD(float argument);
    PwmOut phaseA;
    PwmOut phaseB;
    PwmOut phaseC;
    DigitalOut enable;
    static const size_t SineArraySize = 91;
    const std::array<float, SineArraySize> SineLUT
    {
        0.0F, 0.0174524064372835F, 0.034899496702501F, 0.0523359562429438F, 0.0697564737441253F,
        0.0871557427476582F, 0.104528463267653F, 0.121869343405147F, 0.139173100960065F, 0.156434465040231F,
        0.17364817766693F, 0.190808995376545F, 0.207911690817759F, 0.224951054343865F, 0.241921895599668F,
        0.258819045102521F, 0.275637355816999F, 0.292371704722737F, 0.309016994374947F, 0.325568154457157F,
        0.342020143325669F, 0.3583679495453F, 0.374606593415912F, 0.390731128489274F, 0.4067366430758F,
        0.422618261740699F, 0.438371146789077F, 0.453990499739547F, 0.469471562785891F, 0.484809620246337F,
        0.5F, 0.515038074910054F, 0.529919264233205F, 0.544639035015027F, 0.559192903470747F,
        0.573576436351046F, 0.587785252292473F, 0.601815023152048F, 0.615661475325658F, 0.629320391049837F,
        0.642787609686539F, 0.656059028990507F, 0.669130606358858F, 0.681998360062498F, 0.694658370458997F,
        0.707106781186548F, 0.719339800338651F, 0.73135370161917F, 0.743144825477394F, 0.754709580222772F,
        0.766044443118978F, 0.777145961456971F, 0.788010753606722F, 0.798635510047293F, 0.809016994374947F,
        0.819152044288992F, 0.829037572555042F, 0.838670567945424F, 0.848048096156426F, 0.857167300702112F,
        0.866025403784439F, 0.874619707139396F, 0.882947592858927F, 0.891006524188368F, 0.898794046299167F,
        0.90630778703665F, 0.913545457642601F, 0.92050485345244F, 0.927183854566787F, 0.933580426497202F,
        0.939692620785908F, 0.945518575599317F, 0.951056516295153F, 0.956304755963035F, 0.961261695938319F,
        0.965925826289068F, 0.970295726275996F, 0.974370064785235F, 0.978147600733806F, 0.981627183447664F,
        0.984807753012208F, 0.987688340595138F, 0.99026806874157F, 0.992546151641322F, 0.994521895368273F,
        0.996194698091746F, 0.997564050259824F, 0.998629534754574F, 0.999390827019096F, 0.999847695156391F,
        1.0F
    };
};

#endif /* BLDC_H_ */